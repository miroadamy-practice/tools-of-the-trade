# 02-03 - Handcrafting an image

If you run your website from a pre-built base image, it will require a manual process to set up the container each time it runs. For repeatability and scalability, the container, and your website code should be made into an image.

In this lab, you will start with a base webserver image, modify settings in the container for your website, and then create images from the container. You'll demonstrate the importance of small changes to your container, and how they affect your image. Lastly, you will use your new images to create containers to see your hard work in action.


```sh

 $ ssh cloud_user@35.153.80.99

Host '35.153.80.99' is not in the trusted hosts file.
(ssh-ed25519 fingerprint sha1!! 05:8f:bb:da:44:a8:a1:99:d0:2a:7e:12:39:81:5f:83:17:63:aa:b8)
Do you want to continue connecting? (y/n) y
cloud_user@35.153.80.99's password:
[cloud_user@ip-10-0-1-7 ~]$ docker pull httpd:2.4
2.4: Pulling from library/httpd
f1f26f570256: Pull complete
a6b093ae1967: Pull complete
6b400bbb27df: Pull complete
d9833ead928a: Pull complete
ace056404ed3: Pull complete
Digest: sha256:f3e9eb9acace5bbc13c924293d2247a65bb59b8f062bcd98cd87ee4e18f86733
Status: Downloaded newer image for httpd:2.4
docker.io/library/httpd:2.4
[cloud_user@ip-10-0-1-7 ~]$ docker run --name webtemplate -d httpd:2.4
c6bbc69f3a4954146e314529d2c292ee909c65e6da1414c39071b8f137f5030f
[cloud_user@ip-10-0-1-7 ~]$ docker ps
CONTAINER ID   IMAGE       COMMAND              CREATED         STATUS         PORTS     NAMES
c6bbc69f3a49   httpd:2.4   "httpd-foreground"   5 seconds ago   Up 4 seconds   80/tcp    webtemplate
[cloud_user@ip-10-0-1-7 ~]$ docker exec -it webtemplate bash
root@c6bbc69f3a49:/usr/local/apache2# apt update && apt install git -y
Get:1 http://deb.debian.org/debian bullseye InRelease [116 kB]
Get:2 http://deb.debian.org/debian-security bullseye-security InRelease [48.4 kB]
Get:3 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]
Get:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8183 kB]
Get:5 http://deb.debian.org/debian-security bullseye-security/main amd64 Packages [236 kB]
Get:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]
Fetched 8642 kB in 2s (4996 kB/s)
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
1 package can be upgraded. Run 'apt list --upgradable' to see it.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  git-man less libbsd0 libcbor0 libcurl3-gnutls libedit2 liberror-perl libfido2-1 libgdbm-compat4 libmd0 libperl5.32 libx11-6 libx11-data libxau6 libxcb1
  libxdmcp6 libxext6 libxmuu1 netbase openssh-client patch perl perl-modules-5.32 xauth
Suggested packages:
  gettext-base git-daemon-run | git-daemon-sysvinit git-doc git-el git-email git-gui gitk gitweb git-cvs git-mediawiki git-svn sensible-utils keychain
  libpam-ssh monkeysphere ssh-askpass ed diffutils-doc perl-doc libterm-readline-gnu-perl | libterm-readline-perl-perl make libtap-harness-archive-perl
The following NEW packages will be installed:
  git git-man less libbsd0 libcbor0 libcurl3-gnutls libedit2 liberror-perl libfido2-1 libgdbm-compat4 libmd0 libperl5.32 libx11-6 libx11-data libxau6
  libxcb1 libxdmcp6 libxext6 libxmuu1 netbase openssh-client patch perl perl-modules-5.32 xauth
0 upgraded, 25 newly installed, 0 to remove and 1 not upgraded.
Need to get 17.9 MB of archives.
After this operation, 95.7 MB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bullseye/main amd64 perl-modules-5.32 all 5.32.1-4+deb11u2 [2823 kB]
Get:2 http://deb.debian.org/debian bullseye/main amd64 libgdbm-compat4 amd64 1.19-2 [44.7 kB]
Get:3 http://deb.debian.org/debian bullseye/main amd64 libperl5.32 amd64 5.32.1-4+deb11u2 [4106 kB]
Get:4 http://deb.debian.org/debian bullseye/main amd64 perl amd64 5.32.1-4+deb11u2 [293 kB]
Get:5 http://deb.debian.org/debian bullseye/main amd64 less amd64 551-2 [133 kB]
Get:6 http://deb.debian.org/debian bullseye/main amd64 netbase all 6.3 [19.9 kB]
Get:7 http://deb.debian.org/debian bullseye/main amd64 libmd0 amd64 1.0.3-3 [28.0 kB]
Get:8 http://deb.debian.org/debian bullseye/main amd64 libbsd0 amd64 0.11.3-1 [108 kB]
Get:9 http://deb.debian.org/debian bullseye/main amd64 libedit2 amd64 3.1-20191231-2+b1 [96.7 kB]
Get:10 http://deb.debian.org/debian bullseye/main amd64 libcbor0 amd64 0.5.0+dfsg-2 [24.0 kB]
Get:11 http://deb.debian.org/debian bullseye/main amd64 libfido2-1 amd64 1.6.0-2 [53.3 kB]
Get:12 http://deb.debian.org/debian bullseye/main amd64 openssh-client amd64 1:8.4p1-5+deb11u1 [929 kB]
Get:13 http://deb.debian.org/debian-security bullseye-security/main amd64 libcurl3-gnutls amd64 7.74.0-1.3+deb11u7 [343 kB]
Get:14 http://deb.debian.org/debian bullseye/main amd64 liberror-perl all 0.17029-1 [31.0 kB]
Get:15 http://deb.debian.org/debian-security bullseye-security/main amd64 git-man all 1:2.30.2-1+deb11u2 [1828 kB]
Get:16 http://deb.debian.org/debian-security bullseye-security/main amd64 git amd64 1:2.30.2-1+deb11u2 [5518 kB]
Get:17 http://deb.debian.org/debian bullseye/main amd64 libxau6 amd64 1:1.0.9-1 [19.7 kB]
Get:18 http://deb.debian.org/debian bullseye/main amd64 libxdmcp6 amd64 1:1.1.2-3 [26.3 kB]
Get:19 http://deb.debian.org/debian bullseye/main amd64 libxcb1 amd64 1.14-3 [140 kB]
Get:20 http://deb.debian.org/debian bullseye/main amd64 libx11-data all 2:1.7.2-1 [311 kB]
Get:21 http://deb.debian.org/debian bullseye/main amd64 libx11-6 amd64 2:1.7.2-1 [772 kB]
Get:22 http://deb.debian.org/debian bullseye/main amd64 libxext6 amd64 2:1.3.3-1.1 [52.7 kB]
Get:23 http://deb.debian.org/debian bullseye/main amd64 libxmuu1 amd64 2:1.1.2-2+b3 [23.9 kB]
Get:24 http://deb.debian.org/debian bullseye/main amd64 patch amd64 2.7.6-7 [128 kB]
Get:25 http://deb.debian.org/debian bullseye/main amd64 xauth amd64 1:1.1-1 [40.5 kB]
Fetched 17.9 MB in 0s (103 MB/s)
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package perl-modules-5.32.
(Reading database ... 7140 files and directories currently installed.)
Preparing to unpack .../00-perl-modules-5.32_5.32.1-4+deb11u2_all.deb ...
Unpacking perl-modules-5.32 (5.32.1-4+deb11u2) ...
Selecting previously unselected package libgdbm-compat4:amd64.
Preparing to unpack .../01-libgdbm-compat4_1.19-2_amd64.deb ...
Unpacking libgdbm-compat4:amd64 (1.19-2) ...
Selecting previously unselected package libperl5.32:amd64.
Preparing to unpack .../02-libperl5.32_5.32.1-4+deb11u2_amd64.deb ...
Unpacking libperl5.32:amd64 (5.32.1-4+deb11u2) ...
Selecting previously unselected package perl.
Preparing to unpack .../03-perl_5.32.1-4+deb11u2_amd64.deb ...
Unpacking perl (5.32.1-4+deb11u2) ...
Selecting previously unselected package less.
Preparing to unpack .../04-less_551-2_amd64.deb ...
Unpacking less (551-2) ...
Selecting previously unselected package netbase.
Preparing to unpack .../05-netbase_6.3_all.deb ...
Unpacking netbase (6.3) ...
Selecting previously unselected package libmd0:amd64.
Preparing to unpack .../06-libmd0_1.0.3-3_amd64.deb ...
Unpacking libmd0:amd64 (1.0.3-3) ...
Selecting previously unselected package libbsd0:amd64.
Preparing to unpack .../07-libbsd0_0.11.3-1_amd64.deb ...
Unpacking libbsd0:amd64 (0.11.3-1) ...
Selecting previously unselected package libedit2:amd64.
Preparing to unpack .../08-libedit2_3.1-20191231-2+b1_amd64.deb ...
Unpacking libedit2:amd64 (3.1-20191231-2+b1) ...
Selecting previously unselected package libcbor0:amd64.
Preparing to unpack .../09-libcbor0_0.5.0+dfsg-2_amd64.deb ...
Unpacking libcbor0:amd64 (0.5.0+dfsg-2) ...
Selecting previously unselected package libfido2-1:amd64.
Preparing to unpack .../10-libfido2-1_1.6.0-2_amd64.deb ...
Unpacking libfido2-1:amd64 (1.6.0-2) ...
Selecting previously unselected package openssh-client.
Preparing to unpack .../11-openssh-client_1%3a8.4p1-5+deb11u1_amd64.deb ...
Unpacking openssh-client (1:8.4p1-5+deb11u1) ...
Selecting previously unselected package libcurl3-gnutls:amd64.
Preparing to unpack .../12-libcurl3-gnutls_7.74.0-1.3+deb11u7_amd64.deb ...
Unpacking libcurl3-gnutls:amd64 (7.74.0-1.3+deb11u7) ...
Selecting previously unselected package liberror-perl.
Preparing to unpack .../13-liberror-perl_0.17029-1_all.deb ...
Unpacking liberror-perl (0.17029-1) ...
Selecting previously unselected package git-man.
Preparing to unpack .../14-git-man_1%3a2.30.2-1+deb11u2_all.deb ...
Unpacking git-man (1:2.30.2-1+deb11u2) ...
Selecting previously unselected package git.
Preparing to unpack .../15-git_1%3a2.30.2-1+deb11u2_amd64.deb ...
Unpacking git (1:2.30.2-1+deb11u2) ...
Selecting previously unselected package libxau6:amd64.
Preparing to unpack .../16-libxau6_1%3a1.0.9-1_amd64.deb ...
Unpacking libxau6:amd64 (1:1.0.9-1) ...
Selecting previously unselected package libxdmcp6:amd64.
Preparing to unpack .../17-libxdmcp6_1%3a1.1.2-3_amd64.deb ...
Unpacking libxdmcp6:amd64 (1:1.1.2-3) ...
Selecting previously unselected package libxcb1:amd64.
Preparing to unpack .../18-libxcb1_1.14-3_amd64.deb ...
Unpacking libxcb1:amd64 (1.14-3) ...
Selecting previously unselected package libx11-data.
Preparing to unpack .../19-libx11-data_2%3a1.7.2-1_all.deb ...
Unpacking libx11-data (2:1.7.2-1) ...
Selecting previously unselected package libx11-6:amd64.
Preparing to unpack .../20-libx11-6_2%3a1.7.2-1_amd64.deb ...
Unpacking libx11-6:amd64 (2:1.7.2-1) ...
Selecting previously unselected package libxext6:amd64.
Preparing to unpack .../21-libxext6_2%3a1.3.3-1.1_amd64.deb ...
Unpacking libxext6:amd64 (2:1.3.3-1.1) ...
Selecting previously unselected package libxmuu1:amd64.
Preparing to unpack .../22-libxmuu1_2%3a1.1.2-2+b3_amd64.deb ...
Unpacking libxmuu1:amd64 (2:1.1.2-2+b3) ...
Selecting previously unselected package patch.
Preparing to unpack .../23-patch_2.7.6-7_amd64.deb ...
Unpacking patch (2.7.6-7) ...
Selecting previously unselected package xauth.
Preparing to unpack .../24-xauth_1%3a1.1-1_amd64.deb ...
Unpacking xauth (1:1.1-1) ...
Setting up libxau6:amd64 (1:1.0.9-1) ...
Setting up perl-modules-5.32 (5.32.1-4+deb11u2) ...
Setting up libcbor0:amd64 (0.5.0+dfsg-2) ...
Setting up less (551-2) ...
Setting up libcurl3-gnutls:amd64 (7.74.0-1.3+deb11u7) ...
Setting up libx11-data (2:1.7.2-1) ...
Setting up patch (2.7.6-7) ...
Setting up libgdbm-compat4:amd64 (1.19-2) ...
Setting up libperl5.32:amd64 (5.32.1-4+deb11u2) ...
Setting up libmd0:amd64 (1.0.3-3) ...
Setting up git-man (1:2.30.2-1+deb11u2) ...
Setting up netbase (6.3) ...
Setting up libfido2-1:amd64 (1.6.0-2) ...
Setting up libbsd0:amd64 (0.11.3-1) ...
Setting up libxdmcp6:amd64 (1:1.1.2-3) ...
Setting up libxcb1:amd64 (1.14-3) ...
Setting up libedit2:amd64 (3.1-20191231-2+b1) ...
Setting up perl (5.32.1-4+deb11u2) ...
Setting up libx11-6:amd64 (2:1.7.2-1) ...
Setting up libxmuu1:amd64 (2:1.1.2-2+b3) ...
Setting up openssh-client (1:8.4p1-5+deb11u1) ...
Setting up libxext6:amd64 (2:1.3.3-1.1) ...
Setting up liberror-perl (0.17029-1) ...
Setting up git (1:2.30.2-1+deb11u2) ...
Setting up xauth (1:1.1-1) ...
Processing triggers for libc-bin (2.31-13+deb11u5) ...
root@c6bbc69f3a49:/usr/local/apache2#

root@c6bbc69f3a49:/usr/local/apache2# git clone  https://github.com/linuxacademy/content-widget-factory-inc.git /tmp/widget-factory-inc
Cloning into '/tmp/widget-factory-inc'...
remote: Enumerating objects: 11, done.
remote: Counting objects: 100% (11/11), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 11 (delta 3), reused 11 (delta 3), pack-reused 0
Receiving objects: 100% (11/11), 11.56 KiB | 11.56 MiB/s, done.
Resolving deltas: 100% (3/3), done.

root@c6bbc69f3a49:/usr/local/apache2# ls -l /tmp/widget-factory-inc/
total 0
drwxr-xr-x. 3 root root 93 Mar 25 22:40 web
root@c6bbc69f3a49:/usr/local/apache2# ls -l htdocs/
total 4
-rw-r--r--. 1 501 staff 45 Jun 11  2007 index.html
root@c6bbc69f3a49:/usr/local/apache2# rm htdocs/index.html
root@c6bbc69f3a49:/usr/local/apache2# cp -r /tmp/widget-factory-inc/web/* htdocs/
root@c6bbc69f3a49:/usr/local/apache2# ls -l htdocs/
total 16
drwxr-xr-x. 2 root root   76 Mar 25 22:41 img
-rw-r--r--. 1 root root 3059 Mar 25 22:41 index.html
-rw-r--r--. 1 root root 2910 Mar 25 22:41 quote.html
-rw-r--r--. 1 root root 2611 Mar 25 22:41 support.html
-rw-r--r--. 1 root root 2645 Mar 25 22:41 widgets.html
root@c6bbc69f3a49:/usr/local/apache2# exit
exit
[cloud_user@ip-10-0-1-7 ~]$

```

### Create an image

```sh

cloud_user@ip-10-0-1-7 ~]$ docker ps
CONTAINER ID   IMAGE       COMMAND              CREATED         STATUS         PORTS     NAMES
c6bbc69f3a49   httpd:2.4   "httpd-foreground"   6 minutes ago   Up 6 minutes   80/tcp    webtemplate
[cloud_user@ip-10-0-1-7 ~]$ docker commit c6bbc69f3a49 example/widgetfactory:v1
sha256:82e9370f43d3f3ec77aec9745229e1a6d0f923a0487de54fde9cab2dd5370227
[cloud_user@ip-10-0-1-7 ~]$ docker images
REPOSITORY              TAG       IMAGE ID       CREATED         SIZE
example/widgetfactory   v1        82e9370f43d3   9 seconds ago   243MB
httpd                   2.4       192d41583429   2 days ago      145MB

cloud_user@ip-10-0-1-7 ~]$ docker exec -it webtemplate bash
root@c6bbc69f3a49:/usr/local/apache2# rm -rf /tmp/widget-factory-inc/
root@c6bbc69f3a49:/usr/local/apache2# apt remove git -y && apt autoremove -y && apt clean
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  git-man less libbsd0 libcbor0 libcurl3-gnutls libedit2 liberror-perl libfido2-1 libgdbm-compat4 libmd0 libperl5.32 libx11-6 libx11-data libxau6 libxcb1
  libxdmcp6 libxext6 libxmuu1 netbase openssh-client patch perl perl-modules-5.32 xauth
Use 'apt autoremove' to remove them.
The following packages will be REMOVED:
  git
0 upgraded, 0 newly installed, 1 to remove and 1 not upgraded.
After this operation, 35.9 MB disk space will be freed.
(Reading database ... 10539 files and directories currently installed.)
Removing git (1:2.30.2-1+deb11u2) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  git-man less libbsd0 libcbor0 libcurl3-gnutls libedit2 liberror-perl libfido2-1 libgdbm-compat4 libmd0 libperl5.32 libx11-6 libx11-data libxau6 libxcb1
  libxdmcp6 libxext6 libxmuu1 netbase openssh-client patch perl perl-modules-5.32 xauth
0 upgraded, 0 newly installed, 24 to remove and 1 not upgraded.
After this operation, 59.8 MB disk space will be freed.
(Reading database ... 9737 files and directories currently installed.)
Removing git-man (1:2.30.2-1+deb11u2) ...
Removing less (551-2) ...
Removing xauth (1:1.1-1) ...
Removing libxmuu1:amd64 (2:1.1.2-2+b3) ...
Removing openssh-client (1:8.4p1-5+deb11u1) ...
Removing libedit2:amd64 (3.1-20191231-2+b1) ...
Removing libfido2-1:amd64 (1.6.0-2) ...
Removing libcbor0:amd64 (0.5.0+dfsg-2) ...
Removing libcurl3-gnutls:amd64 (7.74.0-1.3+deb11u7) ...
Removing liberror-perl (0.17029-1) ...
Removing perl (5.32.1-4+deb11u2) ...
Removing libperl5.32:amd64 (5.32.1-4+deb11u2) ...
Removing libgdbm-compat4:amd64 (1.19-2) ...
Removing libxext6:amd64 (2:1.3.3-1.1) ...
Removing netbase (6.3) ...
Removing patch (2.7.6-7) ...
Removing perl-modules-5.32 (5.32.1-4+deb11u2) ...
Removing libx11-6:amd64 (2:1.7.2-1) ...
Removing libxcb1:amd64 (1.14-3) ...
Removing libxdmcp6:amd64 (1:1.1.2-3) ...
Removing libbsd0:amd64 (0.11.3-1) ...
Removing libmd0:amd64 (1.0.3-3) ...
Removing libx11-data (2:1.7.2-1) ...
Removing libxau6:amd64 (1:1.0.9-1) ...
Processing triggers for libc-bin (2.31-13+deb11u5) ...
root@c6bbc69f3a49:/usr/local/apache2# exit
exit
[cloud_user@ip-10-0-1-7 ~]$ docker ps
CONTAINER ID   IMAGE       COMMAND              CREATED         STATUS         PORTS     NAMES
c6bbc69f3a49   httpd:2.4   "httpd-foreground"   9 minutes ago   Up 9 minutes   80/tcp    webtemplate
[cloud_user@ip-10-0-1-7 ~]$ docker commit c6bbc69f3a49 example/widgetfactory:v2
sha256:00455e422187f7ae6aadcf20c89f7228f8088f46e564d71d741580981cc48d27
[cloud_user@ip-10-0-1-7 ~]$ docker images
REPOSITORY              TAG       IMAGE ID       CREATED         SIZE
example/widgetfactory   v2        00455e422187   4 seconds ago   164MB
example/widgetfactory   v1        82e9370f43d3   2 minutes ago   243MB
httpd                   2.4       192d41583429   2 days ago      145MB


[cloud_user@ip-10-0-1-7 ~]$ docker rmi example/widgetfactory:v1
Untagged: example/widgetfactory:v1
Deleted: sha256:82e9370f43d3f3ec77aec9745229e1a6d0f923a0487de54fde9cab2dd5370227
Deleted: sha256:f63904090f66ae8a7f979b7b9715c69f5f634dcb488224c670ba48042b073cde
[cloud_user@ip-10-0-1-7 ~]$ docker run -d --name web1 -p 8081:80 example/widgetfactory:v2
8d788db9d3c595fc95352b70be3e78c1695cfa7a162a60f6c62c62642055dab0
[cloud_user@ip-10-0-1-7 ~]$ docker run -d --name web2 -p 8082:80 example/widgetfactory:v2
f9538528f889c27a1a81b8b219bf0dc3417da724fc37d9b25f0b543b65e799a3
[cloud_user@ip-10-0-1-7 ~]$ docker run -d --name web3 -p 8083:80 example/widgetfactory:v2
d13803a40652b4000f907061cde4c4c96c9d8167d48ceed889c229ae609efb5c
[cloud_user@ip-10-0-1-7 ~]$ docker ps
CONTAINER ID   IMAGE                      COMMAND              CREATED          STATUS          PORTS                                   NAMES
d13803a40652   example/widgetfactory:v2   "httpd-foreground"   4 seconds ago    Up 3 seconds    0.0.0.0:8083->80/tcp, :::8083->80/tcp   web3
f9538528f889   example/widgetfactory:v2   "httpd-foreground"   13 seconds ago   Up 12 seconds   0.0.0.0:8082->80/tcp, :::8082->80/tcp   web2
8d788db9d3c5   example/widgetfactory:v2   "httpd-foreground"   22 seconds ago   Up 21 seconds   0.0.0.0:8081->80/tcp, :::8081->80/tcp   web1
c6bbc69f3a49   httpd:2.4                  "httpd-foreground"   11 minutes ago   Up 11 minutes   80/tcp                                  webtemplate
[cloud_user@ip-10-0-1-7 ~]$


```